    <script>
        // GitHub Admin System with Enhanced Security
        class GitHubAdmin {
            constructor() {
                this.token = '';
                this.repo = '';
                this.configFilePath = '';
                this.currentConfig = null;

                this.initializeElements();
                this.bindEvents();
                this.loadStoredCredentials();
            }

            initializeElements() {
                // Auth elements
                this.githubTokenInput = document.getElementById('githubToken');
                this.githubRepoInput = document.getElementById('githubRepo');
                this.configFilePathInput = document.getElementById('configFilePath');
                this.connectBtn = document.getElementById('connectBtn');
                
                // Dashboard elements
                this.dashboard = document.getElementById('dashboard');
                this.authStatus = document.getElementById('authStatus');
                this.logoutBtn = document.getElementById('logoutBtn');
                this.repoNameDisplay = document.getElementById('repoNameDisplay');
                this.configFileDisplay = document.getElementById('configFileDisplay');
                
                // Form elements
                this.latestVersionInput = document.getElementById('latestVersion');
                this.versionCodeInput = document.getElementById('versionCode');
                this.downloadUrlInput = document.getElementById('downloadUrl');
                this.filePathInput = document.getElementById('filePath');
                this.fileSizeInput = document.getElementById('fileSize');
                this.releaseNotesInput = document.getElementById('releaseNotes');
                
                // Action buttons
                this.saveConfigBtn = document.getElementById('saveConfigBtn');
                this.fetchConfigBtn = document.getElementById('fetchConfigBtn');
                this.validateConfigBtn = document.getElementById('validateConfigBtn');
                this.togglePasswordBtn = document.getElementById('togglePasswordBtn');
                
                // Display elements
                this.configDisplay = document.getElementById('configDisplay');
                this.statusMessage = document.getElementById('statusMessage');
            }

            bindEvents() {
                this.connectBtn.addEventListener('click', () => this.connectToGitHub());
                this.logoutBtn.addEventListener('click', () => this.logout());
                this.saveConfigBtn.addEventListener('click', () => this.updateConfigFile());
                this.fetchConfigBtn.addEventListener('click', () => this.fetchConfigFile());
                this.validateConfigBtn.addEventListener('click', () => this.validateConfiguration());
                
                // Password visibility toggle
                if (this.togglePasswordBtn) {
                    this.togglePasswordBtn.addEventListener('click', () => this.togglePasswordVisibility());
                }
                
                // Add event listeners to clear token on page unload for security
                window.addEventListener('beforeunload', () => {
                    this.clearSensitiveData();
                });
            }

            // Load stored credentials if available (encrypted)
            loadStoredCredentials() {
                try {
                    const encryptedToken = localStorage.getItem('github_token_enc');
                    const savedRepo = localStorage.getItem('github_repo');
                    const savedConfigPath = localStorage.getItem('config_file_path');
                    
                    if (encryptedToken && savedRepo && savedConfigPath) {
                        this.githubRepoInput.value = savedRepo;
                        this.configFilePathInput.value = savedConfigPath;
                        
                        // Ask user if they want to use saved credentials
                        if (confirm('Saved credentials found. Would you like to use them?')) {
                            // Decrypt token and populate field
                            try {
                                this.githubTokenInput.value = this.decryptData(encryptedToken);
                                this.authStatus.textContent = 'Saved credentials loaded';
                            } catch (e) {
                                console.warn('Could not decrypt saved token');
                            }
                        }
                    }
                } catch (e) {
                    console.warn('Error loading saved credentials:', e);
                }
            }

            // Simple encryption for storing tokens
            encryptData(data) {
                // In a real implementation, use proper encryption like Web Crypto API
                // This is a simple obfuscation for demo purposes
                return btoa(encodeURIComponent(data));
            }

            decryptData(encryptedData) {
                // In a real implementation, use proper decryption like Web Crypto API
                // This is a simple deobfuscation for demo purposes
                return decodeURIComponent(atob(encryptedData));
            }

            // Store credentials securely
            storeCredentials() {
                try {
                    if (document.getElementById('rememberCredentials').checked) {
                        const encryptedToken = this.encryptData(this.token);
                        localStorage.setItem('github_token_enc', encryptedToken);
                        localStorage.setItem('github_repo', this.repo);
                        localStorage.setItem('config_file_path', this.configFilePath);
                        
                        this.showStatus('Credentials saved securely', 'success');
                    } else {
                        localStorage.removeItem('github_token_enc');
                        localStorage.removeItem('github_repo');
                        localStorage.removeItem('config_file_path');
                    }
                } catch (e) {
                    console.warn('Error saving credentials:', e);
                }
            }

            // Clear sensitive data
            clearSensitiveData() {
                this.token = '';
                this.githubTokenInput.value = '';
                
                // Clear any references to token in memory
                delete this.token;
            }

            togglePasswordVisibility() {
                const type = this.githubTokenInput.getAttribute('type') === 'password' ? 'text' : 'password';
                this.githubTokenInput.setAttribute('type', type);
                
                // Update button text
                const button = document.getElementById('togglePasswordBtn');
                button.textContent = type === 'password' ? 'ðŸ‘ï¸' : 'ðŸ”’';
            }

            showStatus(message, type = 'success') {
                this.statusMessage.textContent = message;
                this.statusMessage.className = `status ${type}`;
                
                // Auto-hide success messages after 5 seconds
                if (type === 'success') {
                    setTimeout(() => {
                        this.statusMessage.classList.add('hidden');
                    }, 5000);
                }
            }

            hideStatus() {
                this.statusMessage.classList.add('hidden');
            }

            async connectToGitHub() {
                this.token = this.githubTokenInput.value.trim();
                this.repo = this.githubRepoInput.value.trim();
                this.configFilePath = this.configFilePathInput.value.trim();

                if (!this.token || !this.repo || !this.configFilePath) {
                    this.showStatus('Please fill in all fields', 'error');
                    return;
                }

                // Test the connection by fetching the config file
                try {
                    this.showStatus('Connecting to GitHub...', 'loading');
                    
                    // Set auth status
                    this.authStatus.textContent = 'Connected';
                    this.logoutBtn.style.display = 'inline-block';
                    
                    // Show dashboard
                    this.dashboard.classList.remove('hidden');
                    
                    // Update repo info display
                    this.repoNameDisplay.textContent = this.repo;
                    this.configFileDisplay.textContent = this.configFilePath;
                    
                    // Fetch the current config
                    await this.fetchConfigFile();
                    
                    // Store credentials if user wants to remember them
                    this.storeCredentials();
                    
                    this.showStatus('Successfully connected to GitHub!', 'success');
                } catch (error) {
                    this.showStatus(`Connection failed: ${error.message}`, 'error');
                    this.authStatus.textContent = 'Connection failed';
                }
            }

            async fetchConfigFile() {
                if (!this.token || !this.repo || !this.configFilePath) {
                    this.showStatus('Not properly configured. Please reconnect.', 'error');
                    return;
                }

                try {
                    this.showStatus('Fetching configuration...', 'loading');
                    
                    const response = await fetch(
                        `https://api.github.com/repos/${this.repo}/contents/${this.configFilePath}`,
                        {
                            headers: {
                                'Authorization': `token ${this.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );

                    if (!response.ok) {
                        throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    
                    // Decode the content
                    const content = atob(data.content);
                    this.currentConfig = JSON.parse(content);
                    
                    // Update form fields
                    this.updateFormFromConfig();
                    
                    // Update display
                    this.configDisplay.textContent = JSON.stringify(this.currentConfig, null, 2);
                    
                    this.showStatus('Configuration fetched successfully!', 'success');
                } catch (error) {
                    this.showStatus(`Failed to fetch configuration: ${error.message}`, 'error');
                }
            }

            updateFormFromConfig() {
                if (!this.currentConfig) return;
                
                this.latestVersionInput.value = this.currentConfig.latest_version || '';
                this.versionCodeInput.value = this.currentConfig.latest_version_code || '';
                this.downloadUrlInput.value = this.currentConfig.download_url || '';
                this.filePathInput.value = this.currentConfig.file_path || '';
                this.fileSizeInput.value = this.currentConfig.file_size || '';
                this.releaseNotesInput.value = this.currentConfig.release_notes || '';
            }

            getConfigFromForm() {
                return {
                    latest_version: this.latestVersionInput.value.trim(),
                    latest_version_code: parseInt(this.versionCodeInput.value) || 0,
                    download_url: this.downloadUrlInput.value.trim(),
                    file_path: this.filePathInput.value.trim(),
                    file_size: parseInt(this.fileSizeInput.value) || 0,
                    release_notes: this.releaseNotesInput.value.trim(),
                    last_updated: new Date().toISOString()
                };
            }

            validateConfiguration() {
                const config = this.getConfigFromForm();
                let isValid = true;
                let errors = [];

                if (!config.latest_version) {
                    errors.push('Latest version is required');
                    isValid = false;
                }

                if (!config.download_url) {
                    errors.push('Download URL is required');
                    isValid = false;
                }

                if (!config.file_path) {
                    errors.push('File path is required');
                    isValid = false;
                }

                if (isNaN(config.latest_version_code) || config.latest_version_code <= 0) {
                    errors.push('Version code must be a positive number');
                    isValid = false;
                }

                if (isNaN(config.file_size) || config.file_size <= 0) {
                    errors.push('File size must be a positive number');
                    isValid = false;
                }

                if (!isValid) {
                    this.showStatus('Validation errors:\n' + errors.join('\n'), 'error');
                } else {
                    this.showStatus('Configuration is valid!', 'success');
                }
            }

            async updateConfigFile() {
                if (!this.token || !this.repo || !this.configFilePath) {
                    this.showStatus('Not properly configured. Please reconnect.', 'error');
                    return;
                }

                try {
                    // Validate configuration first
                    const config = this.getConfigFromForm();
                    
                    // Check if we have the file SHA (needed for updating)
                    const response = await fetch(
                        `https://api.github.com/repos/${this.repo}/contents/${this.configFilePath}`,
                        {
                            headers: {
                                'Authorization': `token ${this.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );

                    if (!response.ok) {
                        throw new Error(`Failed to get file info: ${response.status}`);
                    }

                    const fileInfo = await response.json();
                    
                    // Prepare the content to update
                    const content = JSON.stringify(config, null, 2);
                    const encodedContent = btoa(unescape(encodeURIComponent(content)));

                    // Update the file
                    const updateResponse = await fetch(
                        `https://api.github.com/repos/${this.repo}/contents/${this.configFilePath}`,
                        {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${this.token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: `Update app configuration via admin panel`,
                                content: encodedContent,
                                sha: fileInfo.sha
                            })
                        }
                    );

                    if (!updateResponse.ok) {
                        const errorData = await updateResponse.json();
                        throw new Error(errorData.message || `GitHub API error: ${updateResponse.status}`);
                    }

                    // Update current config
                    this.currentConfig = config;
                    
                    // Update display
                    this.configDisplay.textContent = JSON.stringify(config, null, 2);

                    this.showStatus('Configuration updated successfully!', 'success');
                } catch (error) {
                    this.showStatus(`Failed to update configuration: ${error.message}`, 'error');
                }
            }

            logout() {
                this.token = '';
                this.repo = '';
                this.configFilePath = '';
                this.currentConfig = null;
                
                this.githubTokenInput.value = '';
                this.dashboard.classList.add('hidden');
                this.authStatus.textContent = 'Not authenticated';
                this.logoutBtn.style.display = 'none';
                
                // Clear sensitive data
                this.clearSensitiveData();
                
                this.hideStatus();
            }
        }

        // Initialize the admin system when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new GitHubAdmin();
        });
    </script>
</body>
</html>